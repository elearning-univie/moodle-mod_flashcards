/**
 * Contain the logic for the question bank modal.
 *
 * @module     mod_flashcards/modalflashcardsquestionbank
 * @copyright 2021 University of Vienna
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_flashcards/modalflashcardsquestionbank",["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment"],(function($,Y,Notification,Modal,ModalEvents,ModalRegistry,Fragment){var registered=!1,SELECTORS_ADD_TO_FLASHCARDS_CONTAINER="td.addtoflashcardsaction",SELECTORS_ANCHOR="a[href]",SELECTORS_PREVIEW_CONTAINER="td.previewaction",SELECTORS_SEARCH_OPTIONS="#advancedsearch",SELECTORS_DISPLAY_OPTIONS="#displayoptions",SELECTORS_ADD_QUESTIONS_FORM='form[action="teacherview.php"]',ModalFlashcardsQuestionBank=function(root){Modal.call(this,root),this.contextId=null,this.addOnPageId=null};return ModalFlashcardsQuestionBank.TYPE="mod_flashcards-flashcards-question-bank",(ModalFlashcardsQuestionBank.prototype=Object.create(Modal.prototype)).constructor=ModalFlashcardsQuestionBank,ModalFlashcardsQuestionBank.prototype.setContextId=function(id){this.contextId=id},ModalFlashcardsQuestionBank.prototype.getContextId=function(){return this.contextId},ModalFlashcardsQuestionBank.prototype.setAddOnPageId=function(id){this.addOnPageId=id},ModalFlashcardsQuestionBank.prototype.getAddOnPageId=function(){return this.addOnPageId},ModalFlashcardsQuestionBank.prototype.show=function(){return this.reloadBodyContent(window.location.search),Modal.prototype.show.call(this)},ModalFlashcardsQuestionBank.prototype.reloadBodyContent=function(queryString){var promise=Fragment.loadFragment("mod_flashcards","questionbank",this.getContextId(),{querystring:queryString}).fail(Notification.exception);this.setBody(promise)},ModalFlashcardsQuestionBank.prototype.handleAddToFlashcardsEvent=function(e,anchorElement){var href=anchorElement.attr("href")+"&addonpage="+this.getAddOnPageId();anchorElement.attr("href",href)},ModalFlashcardsQuestionBank.prototype.handlePreviewContainerEvent=function(e,anchorElement){window.openpopup(e,{url:anchorElement.attr("href"),name:"questionpreview",options:["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"].join(",")})},ModalFlashcardsQuestionBank.prototype.handleDisplayOptionFormEvent=function(e){e.stopPropagation(),e.preventDefault();var queryString="?"+$(e.target).closest(SELECTORS_DISPLAY_OPTIONS).serialize();this.reloadBodyContent(queryString)},ModalFlashcardsQuestionBank.prototype.registerDisplayOptionListeners=function(){this.getModal().on("change",SELECTORS_DISPLAY_OPTIONS,function(e){$(e.target).attr("aria-autocomplete")||this.handleDisplayOptionFormEvent(e)}.bind(this)),this.getModal().on("submit",SELECTORS_DISPLAY_OPTIONS,function(e){this.handleDisplayOptionFormEvent(e)}.bind(this))},ModalFlashcardsQuestionBank.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.registerDisplayOptionListeners(),this.getModal().on("submit",SELECTORS_ADD_QUESTIONS_FORM,function(e){var formElement=$(e.currentTarget);$("<input />").attr("type","hidden").attr("name","addonpage").attr("value",this.getAddOnPageId()).appendTo(formElement)}.bind(this)),this.getModal().on("click",SELECTORS_ANCHOR,function(e){var anchorElement=$(e.currentTarget);anchorElement.closest(SELECTORS_ADD_TO_FLASHCARDS_CONTAINER).length?this.handleAddToFlashcardsEvent(e,anchorElement):anchorElement.closest(SELECTORS_PREVIEW_CONTAINER).length?this.handlePreviewContainerEvent(e,anchorElement):anchorElement.closest(SELECTORS_SEARCH_OPTIONS).length||(e.preventDefault(),this.reloadBodyContent(anchorElement.prop("search")))}.bind(this)),this.getRoot().on(ModalEvents.bodyRendered,(function(){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()}))}))},registered||(ModalRegistry.register(ModalFlashcardsQuestionBank.TYPE,ModalFlashcardsQuestionBank,"core/modal"),registered=!0),ModalFlashcardsQuestionBank}));

//# sourceMappingURL=modalflashcardsquestionbank.min.js.map